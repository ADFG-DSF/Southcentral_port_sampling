---
title: "Southcentral Alaska groundfish"
author: "Adam Reimer"
date: "July 21, 2021"
output: 
  bookdown::word_document2:
#    pandoc_args: ["-Fpandoc-crossref"]
    reference_docx: ".\\doc_styles\\word_styles_FDS.docx"
---

```{r setup, echo=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, fig.cap = TRUE, fig.align = 'center')
library(bookdown)
comp_plots <- readRDS(".\\Rockfish report_96-19\\comp_plots.rds")
```
## Methods

Biologists have an interest in the spatial distribution of rockfish sport harvest and effort from 5 Southcentral Alaska ports (Homer, Kodiak, Seward, Valdez and Whittier). All anglers from a random sample of returning boats are interviewed about fleet membership (charter or private), the target species, the number of fish caught by species, the number of anglers fishing and the area that was fished. Thus, we sample clusters of anglers from single geographic areas during each interview. We seek inference at the scale of the entire port so interview data is pooled  within each port annually for spatial distribution analysis using mutinomial logistic regression. Separate analyses are conducted for each port and species group (pelagic and non-pelagic).   

Annual harvest data $H_{yfa}$ for year $y$ and fleet $f$ in area $a$ was modeled as:

\begin{equation}
H_{yfa}~\sim~\textrm{Multinomial}(p_{yfa}, M_{yf})
\end{equation}

where $M_{yf}~=~\sum_{a}H_{yfa}$ is the total number of fish harvested by interviewed anglers and 

\begin{align*}
p_{yfa} & ~=~\frac{\phi_{yfa}}{\sum_{a}\phi_{yfa}}\\
\log(\phi_{yfa}) & ~=~\alpha_a + \beta_{fa} + \epsilon_{a}*y + \gamma_{fa}*y + re_{yfa}
\end{align*}

subject to the constrain that $\alpha_1 + \beta_{f1} + \epsilon_{1} + \gamma_{f1}~=~\alpha_a + \beta_{1a} + \epsilon_{a} + \gamma_{1a}~=~1$. We expect considerable overdispersion and the term $re_{yfa} \sim~\textrm{Normal}(0, \sigma)$ is an observation level random effect allowing us to model variability that occurs outside of the categorical sampling process. This model was fit using Jags to run 3 chains for 10K iterations each using a 3K iteration burn-in while retaining every 20th iteration. Convergence was assessed using convergence plots and Gelman's $R^2$.  

To detect differences in spatial distribution by fleet and through time we used cross validation to identify the best performing model from among four candidate models: a model where the mean area composition is shared between fleets, a model where the mean area composition differs between fleets, a model where the mean area composition differs between fleets but both fleets share a temporal trend, and a model where the mean area composition and the temporal trend differ between fleets. Thus the candidate models increase in complexity by adding terms to the equation for $\log(\phi_{yfa})$ where the simplest model contains only the $\alpha$ parameter and the random effect while the most complex model contains all 4 parameters and the random effect.    
  
During cross validation data from year $i$ ($H_{ifa}$) was withheld while each model was fit to data for all other years. Model performance was evaluated by calculating the log pointwise predictive density of model $m$ ($lppd_m$) for the withheld data relative to the predicted multinomial probability from the model fit to all years $\ne i$ ($p_{ifa}^{(-is)}$) where s indices the number of simulations from the posterior density.

\begin{equation}
lppd_m~=~-\sum\limits_{y}^{Y_(y \neq i)}lppd_{my}~=~-\sum\limits_{y}^{Y_(y \neq i)}\sum\limits_{f}^{2}log\left(\frac{1}{S}\sum\limits_{s}^{S}\frac{M_{yf}!}{\prod_a H_{yfa}!}\prod_a p_{yfa}^{(-is)}\right)
\end{equation}

Lower values of $lppd_m$ indicate a better model fit. Model comparison is made by calculating $\delta llpd_m~=~ llpd_m - min(lppd_m)$ where values above 0 indicate poor performance relative the the best fitting model. To assess meaningful differences in $\delta llpd_m$ we bootstrapped $\delta llpd_{my}$ for 2000 repetitions and calculated the proportion of all bootstrap samples ($\delta llpd_{my}^*$) where $\sum_y{\delta llpd_{my}^* > 0}$. We selected the model with the minimum $lppd_m$ except when less than 90% of the bootstrap samples of a more parsimonious model summed to greater than 0, in which case we selected the more parsimonious model. 
  
## Composition plots
## Homer 
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the pelagic rockfish harvest out of the port of Homer, 1996-2019."}
comp_plots[[1]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the non-pelagic rockfish harvest out of the port of Homer, 1996-2019."}
comp_plots[[6]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of sport fishing effort out of the port of Homer, 2000-2019."}
comp_plots[[11]]
```
  
## Kodiak 
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the pelagic rockfish harvest out of the port of Kodiak, 1996-2019."}
comp_plots[[2]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the non-pelagic rockfish harvest out of the port of Kodiak, 1996-2019."}
comp_plots[[7]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of sport fishing effort out of the port of Kodiak, 2000-2019."}
comp_plots[[12]]
```
  
## Seward 
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the pelagic rockfish harvest out of the port of Seward, 1996-2019."}
comp_plots[[3]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the non-pelagic rockfish harvest out of the port of Seward, 1996-2019."}
comp_plots[[8]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of sport fishing effort out of the port of Seward, 2000-2019."}
comp_plots[[13]]
```
  
## Valdez 
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the pelagic rockfish harvest out of the port of Valdez, 1996-2019."}
comp_plots[[4]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the non-pelagic rockfish harvest out of the port of Valdez, 1996-2019."}
comp_plots[[9]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of sport fishing effort out of the port of Valdez, 2000-2019."}
comp_plots[[14]]
```
  
## Whittier 
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the pelagic rockfish harvest out of the port of Whittier, 1996-2019."}
comp_plots[[5]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of the non-pelagic rockfish harvest out of the port of Whittier, 1996-2019."}
comp_plots[[10]]
```
  
```{r, fig.height = 6, fig.width = 7.5, fig.cap = "Empirical spatial composition (areas) and estimated mean spatial composition (lines) of sport fishing effort out of the port of Whittier, 2000-2019."}
comp_plots[[15]]
```