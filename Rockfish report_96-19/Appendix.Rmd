---
output: 
  word_document:
    reference_docx: "..\\doc_styles\\word_styles_FDS_break.docx"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, fig.cap = TRUE, fig.align = 'center')
source("..\\functions.R")
library(ggplot2)
library(flextable)
library(tidyverse)

est_spp <- readRDS(".\\spp comp\\est_spp.rds")
est_assem <- readRDS(".\\spp comp\\est_assem.rds")
est_sex <- readRDS(".\\spp comp\\est_sex.rds")
est_age <- readRDS(".\\spp comp\\est_age.rds")
est_lgbin <- readRDS(".\\spp comp\\est_lgbin.rds")
```

#########
Appendix A1.- Species composition of harvest from five Gulf of Alaska ports.
```{r}
est_spp %>%
  mutate(sep_pys = sqrt(vp_pys),
         sepboot_pys = sqrt(vpboot_pys),
         sepreport_pys = ifelse(is.na(vpboot_pys), sep_pys * 2, sepboot_pys),
         est = paste0(format(round(p_pys, 3), digits = 3), " (", format(round(sepreport_pys, 3), digits = 3), ")"),
         year = as.character(year)) %>%
  pivot_wider(id_cols = c("port", "year"), names_from = "spp", values_from = "est") %>%
  flextable() %>%
    merge_v(j = ~ port) %>%
    valign(j = 1, valign = "top") %>%
    align(j = c(3:8), align = "right") %>%
    align(part = "header", j = c(3:8), align = "right") %>%
    line_spacing(space = 0.5) %>%
    font(fontname = "Times New Roman") %>%
    fontsize(size = 10) %>%
    autofit()
```

#########
Appendix B1.- Assembalage composition of harvest from five Gulf of Alaska ports.
```{r}
est_assem %>%
  mutate(sep_pys = sqrt(vp_pys),
         sepboot_pys = sqrt(vpboot_pys),
         sepreport_pys = ifelse(is.na(vpboot_pys), sep_pys * 2, sepboot_pys),
         est = paste0(format(round(p_pys, 3), digits = 3), " (", format(round(sepreport_pys, 3), digits = 3), ")"),
         year = as.character(year)) %>%
  pivot_wider(id_cols = c("port", "year"), names_from = "assem", values_from = "est") %>%
  flextable() %>%
    merge_v(j = ~ port) %>%
    valign(j = 1, valign = "top") %>%
    align(j = c(3:4), align = "right") %>%
    align(part = "header", j = c(3:4), align = "right") %>%
    line_spacing(space = 0.5) %>%
    font(fontname = "Times New Roman") %>%
    fontsize(size = 10) %>%
    autofit()
```

#########
Appendix C1.- Percentage of female of black rockfish in the harvest from five Gulf of Alaska ports.
```{r}
est_sex %>%
  filter(spp == "Black" & sex == "F") %>%
  mutate(p_pysx_report = ppool_pysx,
         sep_pysx_report = sqrt(vppool_pysx),
         est = ifelse(is.na(p_pysx),
                      NA,
                      paste0(format(round(p_pysx_report, 3), digits = 3), " (", format(round(sep_pysx_report, 3), digits = 3), ")")),
         lcilogitp_pysx = log(p_pysx_report / (1-p_pysx_report)) - 1.96 * sqrt(1 / p_pysx_report^2 / (1-p_pysx_report)^2 * sep_pysx_report^2),
         ucilogitp_pysx = log(p_pysx_report / (1-p_pysx_report)) + 1.96 * sqrt(1 / p_pysx_report^2 / (1-p_pysx_report)^2 * sep_pysx_report^2),
         lcip_pysx = exp(lcilogitp_pysx)/(1 + exp(lcilogitp_pysx)),
         ucip_pysx = exp(ucilogitp_pysx)/(1 + exp(ucilogitp_pysx)),
         year = as.character(year))  %>%
  pivot_wider(id_cols = "year", names_from = "port", values_from = "est") %>%
  flextable() %>%
    valign(j = 1, valign = "top") %>%
    align(j = c(2:6), align = "right") %>%
    align(part = "header", j = c(2:6), align = "right") %>%
    line_spacing(space = 0.5) %>%
    font(fontname = "Times New Roman") %>%
    fontsize(size = 10) %>%
    autofit()
```

#########
Appendix C2.- Percentage of female of yelloweye rockfish in the harvest from five Gulf of Alaska ports.
```{r}
est_sex %>%
  filter(spp == "Yelloweye" & sex == "F") %>%
  mutate(p_pysx_report = ppool_pysx,
         sep_pysx_report = sqrt(vppool_pysx),
         est = ifelse(is.na(p_pysx),
                      NA,
                      paste0(format(round(p_pysx_report, 3), digits = 3), " (", format(round(sep_pysx_report, 3), digits = 3), ")")),
         lcilogitp_pysx = log(p_pysx_report / (1-p_pysx_report)) - 1.96 * sqrt(1 / p_pysx_report^2 / (1-p_pysx_report)^2 * sep_pysx_report^2),
         ucilogitp_pysx = log(p_pysx_report / (1-p_pysx_report)) + 1.96 * sqrt(1 / p_pysx_report^2 / (1-p_pysx_report)^2 * sep_pysx_report^2),
         lcip_pysx = exp(lcilogitp_pysx)/(1 + exp(lcilogitp_pysx)),
         ucip_pysx = exp(ucilogitp_pysx)/(1 + exp(ucilogitp_pysx)),
         year = as.character(year))  %>%
  pivot_wider(id_cols = "year", names_from = "port", values_from = "est") %>%
  flextable() %>%
    valign(j = 1, valign = "top") %>%
    align(j = c(3:4), align = "right") %>%
    align(part = "header", j = c(3:4), align = "right") %>%
    line_spacing(space = 0.5) %>%
    font(fontname = "Times New Roman") %>%
    fontsize(size = 10) %>%
    autofit()
```

#########
Appendix D1.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 1996.
```{r}
agetab_bl <- 
  est_age %>%
  rowwise() %>%
  filter(spp %in% "Black") %>%
  mutate(p_pysa_report = ifelse(p05a == FALSE || is.na(p05a) || min < 20, ppool_pysa, p_pysa),
         sep_pysa_report = ifelse(p05a == FALSE || is.na(p05a) || min < 20, seppool_pysa, sep_pysa),
         est = ifelse(is.na(p_pysa_report),
                      NA,
                      paste0(format(round(p_pysa_report, 3), digits = 3), " (", format(round(sep_pysa_report, 3), digits = 3), ")")),
         lcilogitp_pysa = log(p_pysa_report / (1-p_pysa_report)) - 1.96 * sqrt(1 / p_pysa_report^2 / (1-p_pysa_report)^2 * sep_pysa_report^2),
         ucilogitp_pysa = log(p_pysa_report / (1-p_pysa_report)) + 1.96 * sqrt(1 / p_pysa_report^2 / (1-p_pysa_report)^2 * sep_pysa_report^2),
         lcip_pysa = exp(lcilogitp_pysa)/(1 + exp(lcilogitp_pysa)),
         ucip_pysa = exp(ucilogitp_pysa)/(1 + exp(ucilogitp_pysa)),
         est_ci = ifelse(is.na(p_pysa_report),
                      NA,
                      paste0(format(round(p_pysa_report, 3), digits = 3),
                             "(",
                             format(round(lcip_pysa, 3), digits = 3),
                             "-",
                             format(round(ucip_pysa, 3), digits = 3),
                             ")")),
         year = as.character(year),
         port = paste0(port, " (", n, ")"))

agetab_bl %>%
  filter(year == "1996") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```

#########
Appendix D2.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 1997.
```{r}
agetab_bl %>%
  filter(year == "1997") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D3.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 1998.
```{r}
agetab_bl %>%
  filter(year == "1998") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D4.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 1999.
```{r}
agetab_bl %>%
  filter(year == "1999") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D5.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2000.
```{r}
agetab_bl %>%
  filter(year == "2000") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D6.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2001.
```{r}
agetab_bl %>%
  filter(year == "2001") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D7.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2002.
```{r}
agetab_bl %>%
  filter(year == "2002") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D8.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2003.
```{r}
agetab_bl %>%
  filter(year == "2003") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D9.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2004.
```{r}
agetab_bl %>%
  filter(year == "2004") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D10.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2005.
```{r}
agetab_bl %>%
  filter(year == "2005") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D11.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2006.
```{r}
agetab_bl %>%
  filter(year == "2006") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D12.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2007.
```{r}
agetab_bl %>%
  filter(year == "2007") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D13.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2008.
```{r}
agetab_bl %>%
  filter(year == "2008") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D14.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2009.
```{r}
agetab_bl %>%
  filter(year == "2009") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D15.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2010.
```{r}
agetab_bl %>%
  filter(year == "2010") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D16.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2011.
```{r}
agetab_bl %>%
  filter(year == "2011") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D17.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2012.
```{r}
agetab_bl %>%
  filter(year == "2012") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D18.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2013.
```{r}
agetab_bl %>%
  filter(year == "2013") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D19.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2014.
```{r}
agetab_bl %>%
  filter(year == "2014") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D20.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2015.
```{r}
agetab_bl %>%
  filter(year == "2015") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D21.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2016.
```{r}
agetab_bl %>%
  filter(year == "2016") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D22.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2017.
```{r}
agetab_bl %>%
  filter(year == "2017") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D23.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2018.
```{r}
agetab_bl %>%
  filter(year == "2018") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix D24.- Age composition of black rockfish in the harvest from five Gulf of Alaska ports in 2019.
```{r}
agetab_bl %>%
  filter(year == "2019") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E1.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 1996. 
```{r, results = "asis"}
agetab_ye <- 
  est_age %>%
  rowwise() %>%
  filter(spp %in% "Yelloweye") %>%
  mutate(p_pysa_report = ifelse(p05a == FALSE || is.na(p05a) || min < 20, ppool_pysa, p_pysa),
         sep_pysa_report = ifelse(p05a == FALSE || is.na(p05a) || min < 20, seppool_pysa, sep_pysa),
         est = ifelse(is.na(p_pysa_report),
                      NA,
                      paste0(format(round(p_pysa_report, 3), digits = 3), " (", format(round(sep_pysa_report, 3), digits = 3), ")")),
         lcilogitp_pysa = log(p_pysa_report / (1-p_pysa_report)) - 1.96 * sqrt(1 / p_pysa_report^2 / (1-p_pysa_report)^2 * sep_pysa_report^2),
         ucilogitp_pysa = log(p_pysa_report / (1-p_pysa_report)) + 1.96 * sqrt(1 / p_pysa_report^2 / (1-p_pysa_report)^2 * sep_pysa_report^2),
         lcip_pysa = exp(lcilogitp_pysa)/(1 + exp(lcilogitp_pysa)),
         ucip_pysa = exp(ucilogitp_pysa)/(1 + exp(ucilogitp_pysa)),
         est_ci = ifelse(is.na(p_pysa_report),
                      NA,
                      paste0(format(round(p_pysa_report, 3), digits = 3), 
                             "(", 
                             format(round(lcip_pysa, 3), digits = 3), 
                             "-",
                             format(round(ucip_pysa, 3), digits = 3),
                             ")")),
         year = as.character(year),
         port = paste0(port, " (", n, ")"))

agetab_ye %>%
  filter(year == "1996") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable()  %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:5), align = "right") %>%
  align(part = "header", j = c(3:5), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E2.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 1997. 
```{r}
agetab_ye %>%
  filter(year == "1997") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E3.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 1998. 
```{r}
agetab_ye %>%
  filter(year == "1998") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E4.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 1999. 
```{r}
agetab_ye %>%
  filter(year == "1999") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E5.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2000. 
```{r}
agetab_ye %>%
  filter(year == "2000") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E6.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2001. 
```{r}
agetab_ye %>%
  filter(year == "2001") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E7.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2002. 
```{r}
agetab_ye %>%
  filter(year == "2002") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E8.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2003. 
```{r}
agetab_ye %>%
  filter(year == "2003") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E9.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2004. 
```{r}
agetab_ye %>%
  filter(year == "2004") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E10.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2005. 
```{r}
agetab_ye %>%
  filter(year == "2005") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E11.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2006. 
```{r}
agetab_ye %>%
  filter(year == "2006") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E12.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2007. 
```{r}
agetab_ye %>%
  filter(year == "2007") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E13.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2008. 
```{r}
agetab_ye %>%
  filter(year == "2008") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E14.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2009. 
```{r}
agetab_ye %>%
  filter(year == "2009") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E15.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2010. 
```{r}
agetab_ye %>%
  filter(year == "2010") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E16.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2011. 
```{r}
agetab_ye %>%
  filter(year == "2011") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E17.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2012. 
```{r}
agetab_ye %>%
  filter(year == "2012") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E18.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2013. 
```{r}
agetab_ye %>%
  filter(year == "2013") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E19.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2014. 
```{r}
agetab_ye %>%
  filter(year == "2014") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E20.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2015. 
```{r}
agetab_ye %>%
  filter(year == "2015") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E21.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2016. 
```{r}
agetab_ye %>%
  filter(year == "2016") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E22.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2017. 
```{r}
agetab_ye %>%
  filter(year == "2017") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E23.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2018. 
```{r}
agetab_ye %>%
  filter(year == "2018") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix E24.- Age composition of yelloweye rockfish in the harvest from five Gulf of Alaska ports in 2019. 
```{r}
agetab_ye %>%
  filter(year == "2019") %>%
  pivot_wider(id_cols = c("year", "age"), names_from = "port", values_from = "est") %>%
  arrange(age) %>%
  flextable() %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:7), align = "right") %>%
  align(part = "header", j = c(3:7), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix F1.- Length composition of Black rockfish in the harvest from five Gulf of Alaska ports in 1996. 
```{r, results = "asis"}
lgbin_format <- 
  est_lgbin %>%
  rowwise() %>%
  filter(spp %in% c("Black", "Yelloweye")) %>%
  mutate(p_pysl_report = ifelse(p05a == FALSE | is.na(p05a) | min < 10, ppool_pysl, p_pysl),
         sep_pysl_report = ifelse(p05a == FALSE | is.na(p05a) | min < 10, seppool_pysl, sep_pysl),
         est = ifelse(is.na(p_pysl_report),
                      NA,
                      paste0(format(round(p_pysl_report, 3), digits = 3), "(", format(round(sep_pysl_report, 3), digits = 3), ")")),
         lcilogitp_pysl = log(p_pysl_report / (1-p_pysl_report)) - 1.96 * sqrt(1 / p_pysl_report^2 / (1-p_pysl_report)^2 * sep_pysl_report^2),
         ucilogitp_pysl = log(p_pysl_report / (1-p_pysl_report)) + 1.96 * sqrt(1 / p_pysl_report^2 / (1-p_pysl_report)^2 * sep_pysl_report^2),
         lcip_pysl = exp(lcilogitp_pysl)/(1 + exp(lcilogitp_pysl)),
         ucip_pysl = exp(ucilogitp_pysl)/(1 + exp(ucilogitp_pysl)),
         est_ci = ifelse(is.na(p_pysl_report),
                         NA,
                         paste0(format(round(p_pysl_report, 3), digits = 3), 
                                "(", 
                                format(round(lcip_pysl, 3), digits = 3), 
                                "-",
                                format(round(ucip_pysl, 3), digits = 3),
                                ")")),
         year = as.character(year))


lgbin_format %>%
  filter(spp == "Black") %>%
  pivot_wider(id_cols = c("year", "lgbin"), names_from = "port", values_from = "est") %>%
  arrange(year, lgbin) %>%
  flextable()  %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:5), align = "right") %>%
  align(part = "header", j = c(3:5), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
    
#########
Appendix F2.- Length composition of Yelloweye rockfish in the harvest from five Gulf of Alaska ports in 1996. 
```{r, results = "asis"}
lgbin_format <- 
  est_lgbin %>%
  rowwise() %>%
  filter(spp %in% c("Black", "Yelloweye")) %>%
  mutate(p_pysl_report = ifelse(p05a == FALSE | is.na(p05a) | min < 10, ppool_pysl, p_pysl),
         sep_pysl_report = ifelse(p05a == FALSE | is.na(p05a) | min < 10, seppool_pysl, sep_pysl),
         est = ifelse(is.na(p_pysl_report),
                      NA,
                      paste0(format(round(p_pysl_report, 3), digits = 3), "(", format(round(sep_pysl_report, 3), digits = 3), ")")),
         lcilogitp_pysl = log(p_pysl_report / (1-p_pysl_report)) - 1.96 * sqrt(1 / p_pysl_report^2 / (1-p_pysl_report)^2 * sep_pysl_report^2),
         ucilogitp_pysl = log(p_pysl_report / (1-p_pysl_report)) + 1.96 * sqrt(1 / p_pysl_report^2 / (1-p_pysl_report)^2 * sep_pysl_report^2),
         lcip_pysl = exp(lcilogitp_pysl)/(1 + exp(lcilogitp_pysl)),
         ucip_pysl = exp(ucilogitp_pysl)/(1 + exp(ucilogitp_pysl)),
         est_ci = ifelse(is.na(p_pysl_report),
                         NA,
                         paste0(format(round(p_pysl_report, 3), digits = 3), 
                                "(", 
                                format(round(lcip_pysl, 3), digits = 3), 
                                "-",
                                format(round(ucip_pysl, 3), digits = 3),
                                ")")),
         year = as.character(year))


lgbin_format %>%
  filter(spp == "Yelloweye") %>%
  pivot_wider(id_cols = c("year", "lgbin"), names_from = "port", values_from = "est") %>%
  arrange(year, lgbin) %>%
  flextable()  %>%
  merge_v(j = ~ year) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:5), align = "right") %>%
  align(part = "header", j = c(3:5), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  autofit()
```
  
#########
Appendix G1.- Model selection criteria for spatial composition of bottomfish effort from five Gulf of Alaska ports.
```{r}
tab_sd <- readRDS("tab_sd.rds")

#input loocv log likelihoods
ll_Hp <- readRDS(".\\Interview post\\ll_Hp.rds")
ll_Hnpy <- readRDS(".\\Interview post\\ll_Hnpy.rds")
ll_E <- readRDS(".\\Interview post\\ll_E.rds")

#tables with model selection criteria. One for each composition
mod_p <-
  Map(function(x, y){tab_ll(x) %>% dplyr::mutate(port = y, composition = "Harvest: Pelagic")}, 
      x = ll_Hp,
      y = factor(c("Homer", "Kodiak", "Seward", "Valdez", "Whittier"), ordered = TRUE)) %>%
  do.call(rbind, .) %>% 
  dplyr::arrange(desc(composition), port) %>%
  dplyr::select(port, composition, model, ll, diff, p_diff) %>%
  dplyr::left_join(tab_sd, by = c("port", "composition", "model"))
mod_npy <-
  Map(function(x, y){tab_ll(x) %>% dplyr::mutate(port = y, composition = "Harvest: Non-Pelagic")}, 
      x = ll_Hnpy,
      y = factor(c("Homer", "Kodiak", "Seward", "Valdez", "Whittier"), ordered = TRUE)) %>%
  do.call(rbind, .) %>% 
  dplyr::arrange(desc(composition), port) %>%
  dplyr::select(port, composition, model, ll, diff, p_diff) %>%
  dplyr::left_join(tab_sd, by = c("port", "composition", "model"))
mod_E <-
  Map(function(x, y){tab_ll(x) %>% dplyr::mutate(port = y, composition = "Effort")}, 
      x = ll_E,
      y = factor(c("Homer", "Kodiak", "Seward", "Valdez", "Whittier"), ordered = TRUE)) %>%
  do.call(rbind, .) %>% 
  dplyr::arrange(desc(composition), port) %>%
  dplyr::select(port, composition, model, ll, diff, p_diff) %>%
  dplyr::left_join(tab_sd, by = c("port", "composition", "model"))
  
flextable(mod_E[, -2]) %>%
  merge_v(j = ~ port) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>%
  mk_par(part = "header", j = "port", value = as_paragraph("Port")) %>%
  mk_par(part = "header", j = "model", value = as_paragraph("Model")) %>%
  mk_par(part = "header", j = "ll", value = as_paragraph("lppd", as_sub("m"))) %>%
  mk_par(part = "header", j = "diff", value = as_paragraph("\U0394llpd", as_sub("m"), "(SE)")) %>%
  mk_par(part = "header", j = "p_diff", value = as_paragraph("P(\U0394llpd", as_sub("m"), ">0)")) %>%
  mk_par(part = "header", j = "sd", value = as_paragraph("\U03C3", as_sub("re"))) %>%
  bold(i = c(2, 6, 10, 15, 18), j = 2:6) %>%
  autofit()
```

#########
Appendix G2.- Model selection criteria for spatial composition of pelagic rockfish harvest from five Gulf of Alaska ports. 
```{r}
flextable(mod_p[, -2]) %>%
  merge_v(j = ~ port) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>% 
  mk_par(part = "header", j = "port", value = as_paragraph("Port")) %>%
  mk_par(part = "header", j = "model", value = as_paragraph("Model")) %>%
  mk_par(part = "header", j = "ll", value = as_paragraph("lppd", as_sub("m"))) %>% 
  mk_par(part = "header", j = "diff", value = as_paragraph("\U0394llpd", as_sub("m"), "(SE)")) %>% 
  mk_par(part = "header", j = "p_diff", value = as_paragraph("P(\U0394llpd", as_sub("m"), ">0)")) %>% 
  mk_par(part = "header", j = "sd", value = as_paragraph("\U03C3", as_sub("re"))) %>%
  bold(i = c(1, 4, 9, 13, 16), j = 2:6) %>%
  autofit()
```

#########
Appendix G3.- Model selection criteria for spatial composition of non-pelagic rockfish harvest from five Gulf of Alaska ports. 
```{r}
flextable(mod_npy[, -2]) %>%
  merge_v(j = ~ port) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>% 
  mk_par(part = "header", j = "port", value = as_paragraph("Port")) %>%
  mk_par(part = "header", j = "model", value = as_paragraph("Model")) %>%
  mk_par(part = "header", j = "ll", value = as_paragraph("lppd", as_sub("m"))) %>% 
  mk_par(part = "header", j = "diff", value = as_paragraph("\U0394llpd", as_sub("m"), "(SE)")) %>% 
  mk_par(part = "header", j = "p_diff", value = as_paragraph("P(\U0394llpd", as_sub("m"), ">0)")) %>% 
  mk_par(part = "header", j = "sd", value = as_paragraph("\U03C3", as_sub("re"))) %>%
  bold(i = c(1, 4, 9, 13, 16), j = 2:6) %>%
  autofit()
```

#########
Appendix H1.- Reported angler-days of bottomfish effort in Homer, 2000-2019.
```{r, message = FALSE}
int_boat <- readRDS("..\\Data\\int_boat.rds")
#effort data for appendix
int_E <-
  int_boat[int_boat$target %in% c("Rockfish", "Bottomfish", "Bottomfish & Salmon", "Lingcod"), ] %>%
  dplyr::group_by(port, year, fleet, area) %>%
  dplyr::summarise(H = sum(npyH, na.rm = TRUE), E = sum(E, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(year >= 2000)
ports <- unique(int_E$port)
areas <- lapply(ports, function(x) sort(unique(int_E$area[int_E$port == x])))
jags_datE <- lapply(ports, make_jagsdat, dat = int_E, stat = "E")
years_E <- lapply(ports, function(x) range(int_E$year[int_E$port == x]))
tab_E <- lapply(1:5, function(x) tab_data(years_E[[x]][1]:years_E[[x]][2], jags_datE[[x]], areas[[x]]))

#Pelagic rockfish data for appendix
int_pr <-
  int_boat %>%
  dplyr::group_by(port, year, fleet, area) %>%
  dplyr::summarise(H = sum(pH, na.rm = TRUE), E = sum(E, na.rm = TRUE)) %>%
  dplyr::ungroup()
jags_datH <- lapply(ports, make_jagsdat, dat = int_pr, stat = "H")
years_pr <- lapply(ports, function(x) range(int_pr$year[int_pr$port == x]))
tab_pr <- lapply(1:5, function(x) tab_data(years_pr[[x]][1]:years_pr[[x]][2], jags_datH[[x]], areas[[x]]))

#Non-pelagic rockfish data for appendix
int_npr <-
  int_boat %>%
  dplyr::group_by(port, year, fleet, area) %>%
  dplyr::summarise(H = sum(npyH, na.rm = TRUE), E = sum(E, na.rm = TRUE)) %>%
  dplyr::ungroup()
jags_datHnp <- lapply(ports, make_jagsdat, dat = int_npr, stat = "H")
years_npr <- lapply(ports, function(x) range(int_npr$year[int_npr$port == x]))
tab_npr <- lapply(1:5, function(x) tab_data(years_npr[[x]][1]:years_npr[[x]][2], jags_datHnp[[x]], areas[[x]]))


flextable(tab_E[[1]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 8, 5, 10, 8, 5, 5)))
```
  
#########
Appendix H2.- Reported pelagic rockfish harvest in Homer, 1996-2019.
```{r, message = FALSE}
flextable(tab_pr[[1]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 8, 5, 10, 8, 5, 5)))
```

#########
Appendix H3.- Reported non-pelagic rockfish harvest in Homer, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[1]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 8, 5, 10, 8, 5, 5)))
```

#########
Appendix H4.- Reported angler-days of bottomfish effort in Kodiak, 1996-2019.
```{r, message = FALSE}
qflextable(tab_E[[2]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 7, 9, 9, 8, 5)))
```

#########
Appendix H5.- Reported pelagic rockfish harvest in Kodiak, 2000-2019.
```{r, message = FALSE}
flextable(tab_pr[[2]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 7, 9, 9, 8, 5)))
```

#########
Appendix H6.- Reported non-pelagic rockfish harvest in Kodiak, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[2]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 7, 9, 9, 8, 5)))
```


#########
Appendix H7.- Reported angler-days of bottomfish effort in Seward, 2000-2019.
```{r, message = FALSE}
flextable(tab_E[[3]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 5, 6, 10, 8, 5)))
```

#########
Appendix H8.- Reported pelagic rockfish harvest in Seward, 1996-2019.
```{r, message = FALSE}
flextable(tab_pr[[3]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 5, 6, 10, 8, 5)))
```

#########
Appendix H9.- Reported non-pelagic rockfish harvest in Seward, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[3]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 5, 6, 10, 8, 5)))
```

#########
Appendix H10.- Reported angler-days of bottomfish effort in Valdez, 2000-2019.
```{r, message = FALSE}
flextable(tab_E[[4]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix H11.- Reported pelagic rockfish harvest in Valdez, 1996-2019.
```{r, message = FALSE}
flextable(tab_pr[[4]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix H12.- Reported non-pelagic rockfish harvest in Valdez, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[4]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix H13.- Reported angler-days of bottomfish effort in Whittier, 2000-2019.
```{r, message = FALSE}
flextable(tab_E[[5]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix H14.- Reported pelagic rockfish harvest in Whittier, 1998-2019.
```{r, message = FALSE}
flextable(tab_pr[[5]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix H15.- Reported non-pelagic rockfish harvest in Whittier, 1998-2019.
```{r, message = FALSE}
flextable(tab_npr[[5]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```
