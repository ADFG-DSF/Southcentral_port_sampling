---
output: 
  word_document:
    reference_docx: "..\\doc_styles\\word_styles_FDS_break.docx"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, fig.cap = TRUE, fig.align = 'center')
source("..\\functions.R")
library(magrittr)
library(ggplot2)
library(flextable)

tab_sd <- readRDS("tab_sd.rds")

#input loocv log likelihoods
ll_Hp <- readRDS(".\\Interview post\\ll_Hp.rds")
ll_Hnpy <- readRDS(".\\Interview post\\ll_Hnpy.rds")
ll_E <- readRDS(".\\Interview post\\ll_E.rds")

#tables with model selection criteria. One for each composition
mod_p <-
  Map(function(x, y){tab_ll(x) %>% dplyr::mutate(port = y, composition = "Harvest: Pelagic")}, 
      x = ll_Hp,
      y = factor(c("Homer", "Kodiak", "Seward", "Valdez", "Whittier"), ordered = TRUE)) %>%
  do.call(rbind, .) %>% 
  dplyr::arrange(desc(composition), port) %>%
  dplyr::select(port, composition, model, ll, diff, p_diff) %>%
  dplyr::left_join(tab_sd, by = c("port", "composition", "model"))
mod_npy <-
  Map(function(x, y){tab_ll(x) %>% dplyr::mutate(port = y, composition = "Harvest: Non-Pelagic")}, 
      x = ll_Hnpy,
      y = factor(c("Homer", "Kodiak", "Seward", "Valdez", "Whittier"), ordered = TRUE)) %>%
  do.call(rbind, .) %>% 
  dplyr::arrange(desc(composition), port) %>%
  dplyr::select(port, composition, model, ll, diff, p_diff) %>%
  dplyr::left_join(tab_sd, by = c("port", "composition", "model"))
mod_E <-
  Map(function(x, y){tab_ll(x) %>% dplyr::mutate(port = y, composition = "Effort")}, 
      x = ll_E,
      y = factor(c("Homer", "Kodiak", "Seward", "Valdez", "Whittier"), ordered = TRUE)) %>%
  do.call(rbind, .) %>% 
  dplyr::arrange(desc(composition), port) %>%
  dplyr::select(port, composition, model, ll, diff, p_diff) %>%
  dplyr::left_join(tab_sd, by = c("port", "composition", "model"))

```

#########
Appendix A1.- Model selection criteria for spatial composition of bottomfish effort from five Gulf of Alaska ports. 
```{r}
flextable(mod_E[, -2]) %>%
  merge_v(j = ~ port) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>% 
  compose(part = "header", j = "port", value = as_paragraph("Port")) %>%
  compose(part = "header", j = "model", value = as_paragraph("Model")) %>%
  compose(part = "header", j = "ll", value = as_paragraph("lppd", as_sub("m"))) %>% 
  compose(part = "header", j = "diff", value = as_paragraph("\U0394llpd", as_sub("m"), "(SE)")) %>% 
  compose(part = "header", j = "p_diff", value = as_paragraph("P(\U0394llpd", as_sub("m"), ">0)")) %>% 
  compose(part = "header", j = "sd", value = as_paragraph("\U03C3", as_sub("re"))) %>%
  bold(i = c(2, 6, 10, 15, 18), j = 2:6) %>%
  autofit()
```

#########
Appendix A2.- Model selection criteria for spatial composition of pelagic rockfish harvest from five Gulf of Alaska ports. 
```{r}
flextable(mod_p[, -2]) %>%
  merge_v(j = ~ port) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>% 
  compose(part = "header", j = "port", value = as_paragraph("Port")) %>%
  compose(part = "header", j = "model", value = as_paragraph("Model")) %>%
  compose(part = "header", j = "ll", value = as_paragraph("lppd", as_sub("m"))) %>% 
  compose(part = "header", j = "diff", value = as_paragraph("\U0394llpd", as_sub("m"), "(SE)")) %>% 
  compose(part = "header", j = "p_diff", value = as_paragraph("P(\U0394llpd", as_sub("m"), ">0)")) %>% 
  compose(part = "header", j = "sd", value = as_paragraph("\U03C3", as_sub("re"))) %>%
  bold(i = c(1, 4, 9, 13, 16), j = 2:6) %>%
  autofit()
```

#########
Appendix A3.- Model selection criteria for spatial composition of non-pelagic rockfish harvest from five Gulf of Alaska ports. 
```{r}
flextable(mod_npy[, -2]) %>%
  merge_v(j = ~ port) %>%
  valign(j = 1, valign = "top") %>%
  align(j = c(3:6), align = "right") %>%
  align(part = "header", j = c(3:6), align = "right") %>%
  line_spacing(space = 0.5) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 10) %>% 
  compose(part = "header", j = "port", value = as_paragraph("Port")) %>%
  compose(part = "header", j = "model", value = as_paragraph("Model")) %>%
  compose(part = "header", j = "ll", value = as_paragraph("lppd", as_sub("m"))) %>% 
  compose(part = "header", j = "diff", value = as_paragraph("\U0394llpd", as_sub("m"), "(SE)")) %>% 
  compose(part = "header", j = "p_diff", value = as_paragraph("P(\U0394llpd", as_sub("m"), ">0)")) %>% 
  compose(part = "header", j = "sd", value = as_paragraph("\U03C3", as_sub("re"))) %>%
  bold(i = c(1, 4, 9, 13, 16), j = 2:6) %>%
  autofit()
```

#########
Appendix B1.- Reported angler-days of bottomfish effort in Homer, 2000-2019.
```{r, message = FALSE}
int_boat <- readRDS("..\\Data\\int_boat.rds")
#effort data for appendix
int_E <-
  int_boat[int_boat$target %in% c("Rockfish", "Bottomfish", "Bottomfish & Salmon", "Lingcod"), ] %>%
  dplyr::group_by(port, year, fleet, area) %>%
  dplyr::summarise(H = sum(npyH, na.rm = TRUE), E = sum(E, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(year >= 2000)
ports <- unique(int_E$port)
areas <- lapply(ports, function(x) sort(unique(int_E$area[int_E$port == x])))
jags_datE <- lapply(ports, make_jagsdat, dat = int_E, stat = "E")
years_E <- lapply(ports, function(x) range(int_E$year[int_E$port == x]))
tab_E <- lapply(1:5, function(x) tab_data(years_E[[x]][1]:years_E[[x]][2], jags_datE[[x]], areas[[x]]))

#Pelagic rockfish data for appendix
int_pr <-
  int_boat %>%
  dplyr::group_by(port, year, fleet, area) %>%
  dplyr::summarise(H = sum(pH, na.rm = TRUE), E = sum(E, na.rm = TRUE)) %>%
  dplyr::ungroup()
jags_datH <- lapply(ports, make_jagsdat, dat = int_pr, stat = "H")
years_pr <- lapply(ports, function(x) range(int_pr$year[int_pr$port == x]))
tab_pr <- lapply(1:5, function(x) tab_data(years_pr[[x]][1]:years_pr[[x]][2], jags_datH[[x]], areas[[x]]))

#Non-pelagic rockfish data for appendix
int_npr <-
  int_boat %>%
  dplyr::group_by(port, year, fleet, area) %>%
  dplyr::summarise(H = sum(npyH, na.rm = TRUE), E = sum(E, na.rm = TRUE)) %>%
  dplyr::ungroup()
jags_datHnp <- lapply(ports, make_jagsdat, dat = int_npr, stat = "H")
years_npr <- lapply(ports, function(x) range(int_npr$year[int_npr$port == x]))
tab_npr <- lapply(1:5, function(x) tab_data(years_npr[[x]][1]:years_npr[[x]][2], jags_datHnp[[x]], areas[[x]]))


flextable(tab_E[[1]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 8, 5, 10, 8, 5, 5)))
```
  
#########
Appendix B2.- Reported pelagic rockfish harvest in Homer, 1996-2019.
```{r, message = FALSE}
flextable(tab_pr[[1]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 8, 5, 10, 8, 5, 5)))
```

#########
Appendix B3.- Reported non-pelagic rockfish harvest in Homer, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[1]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 8, 5, 10, 8, 5, 5)))
```

#########
Appendix B4.- Reported angler-days of bottomfish effort in Kodiak, 1996-2019.
```{r, message = FALSE}
qflextable(tab_E[[2]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 7, 9, 9, 8, 5)))
```

#########
Appendix B5.- Reported pelagic rockfish harvest in Kodiak, 2000-2019.
```{r, message = FALSE}
flextable(tab_pr[[2]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 7, 9, 9, 8, 5)))
```

#########
Appendix B6.- Reported non-pelagic rockfish harvest in Kodiak, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[2]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 7, 9, 9, 8, 5)))
```


#########
Appendix B7.- Reported angler-days of bottomfish effort in Seward, 2000-2019.
```{r, message = FALSE}
flextable(tab_E[[3]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 5, 6, 10, 8, 5)))
```

#########
Appendix B8.- Reported pelagic rockfish harvest in Seward, 1996-2019.
```{r, message = FALSE}
flextable(tab_pr[[3]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 5, 6, 10, 8, 5)))
```

#########
Appendix B9.- Reported non-pelagic rockfish harvest in Seward, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[3]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  width(width = c(1/8 * c(5, 4, 5, 6, 10, 8, 5)))
```

#########
Appendix B10.- Reported angler-days of bottomfish effort in Valdez, 2000-2019.
```{r, message = FALSE}
flextable(tab_E[[4]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix B11.- Reported pelagic rockfish harvest in Valdez, 1996-2019.
```{r, message = FALSE}
flextable(tab_pr[[4]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix B12.- Reported non-pelagic rockfish harvest in Valdez, 1996-2019.
```{r, message = FALSE}
flextable(tab_npr[[4]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix B13.- Reported angler-days of bottomfish effort in Whittier, 2000-2019.
```{r, message = FALSE}
flextable(tab_E[[5]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix B14.- Reported pelagic rockfish harvest in Whittier, 1998-2019.
```{r, message = FALSE}
flextable(tab_pr[[5]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```

#########
Appendix B15.- Reported non-pelagic rockfish harvest in Whittier, 1998-2019.
```{r, message = FALSE}
flextable(tab_npr[[5]]) %>%
  merge_v(j = ~ Fleet) %>%
  valign(j = 1, valign = "top") %>%
  line_spacing(space = 0.4) %>%
  font(fontname = "Times New Roman") %>%
  fontsize(size = 9) %>%
  colformat_char(j = "Year") %>%
  width(width = c(1/8 * c(5, 4, 8, 7, 8, 5)))
```